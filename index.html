<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenPDF Ultra - The Ultimate Local PDF Suite</title>
    <meta name="description" content="Merge, Split, Convert PDF to Word, Excel, PPT. Serverless & Private.">
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7/download.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --sidebar: #111827;
            --accent: #0ea5e9; /* Sky Blue */
            --accent-hover: #0284c7;
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --border: #334155;
            --success: #10b981;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* App-like feel */
        }

        /* HEADER */
        header {
            padding: 1rem 2rem;
            background: var(--sidebar);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        h1 { font-size: 1.5rem; letter-spacing: -0.5px; }
        h1 span { color: var(--accent); font-weight: 600; }
        .privacy-pill {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            border: 1px solid rgba(16, 185, 129, 0.2);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* LAYOUT */
        .app-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: 260px;
            background: var(--sidebar);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            gap: 0.5rem;
        }

        .category-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin: 1rem 0 0.5rem 0.5rem;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 0.8rem 1rem;
            text-align: left;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .nav-btn:hover { background: rgba(255,255,255,0.05); color: var(--text); }
        .nav-btn.active { background: var(--accent); color: white; font-weight: 600; }
        .nav-btn i { width: 20px; text-align: center; }

        /* MAIN CONTENT */
        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            position: relative;
        }

        .tool-panel {
            display: none;
            max-width: 800px;
            margin: 0 auto;
            animation: fadeIn 0.3s ease;
        }
        .tool-panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 2.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        h2 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        p.desc { color: var(--text-muted); margin-bottom: 2rem; }

        /* DROP ZONE */
        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            background: rgba(15, 23, 42, 0.5);
            margin-bottom: 1.5rem;
        }
        .drop-zone:hover { border-color: var(--accent); background: rgba(14, 165, 233, 0.05); }
        .drop-icon { font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem; }
        
        /* CONTROLS */
        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            transition: 0.2s;
        }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
        .btn:hover:not(:disabled) { background: var(--accent-hover); }

        .file-list { 
            background: rgba(0,0,0,0.2); 
            border-radius: 8px; 
            padding: 0.5rem;
            margin-bottom: 1rem;
            max-height: 150px;
            overflow-y: auto;
        }
        .file-item { 
            padding: 8px 12px; 
            border-bottom: 1px solid rgba(255,255,255,0.05); 
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .file-item:last-child { border-bottom: none; }

        input[type="text"], textarea {
            width: 100%;
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 12px;
            border-radius: 8px;
            color: var(--text);
            margin-bottom: 1rem;
            font-family: inherit;
        }
        textarea { min-height: 150px; resize: vertical; }

        /* FOOTER */
        .mobile-toggle { display: none; }
        
        @media(max-width: 768px) {
            .app-container { flex-direction: column; }
            .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 1px solid var(--border); padding: 0.5rem; flex-direction: row; overflow-x: auto; }
            .nav-btn { white-space: nowrap; padding: 0.5rem 1rem; }
            .category-label { display: none; }
        }
    </style>
</head>
<body>

    <header>
        <h1>ZenPDF <span>Ultra</span></h1>
        <div class="privacy-pill"><i class="fas fa-shield-alt"></i> Offline Mode</div>
    </header>

    <div class="app-container">
        <div class="sidebar">
            <div class="category-label">Essentials</div>
            <button class="nav-btn active" onclick="switchTool('merge')"><i class="fas fa-layer-group"></i> Merge PDF</button>
            <button class="nav-btn" onclick="switchTool('split')"><i class="fas fa-cut"></i> Split PDF</button>
            <button class="nav-btn" onclick="switchTool('watermark')"><i class="fas fa-stamp"></i> Watermark</button>

            <div class="category-label">Convert To PDF</div>
            <button class="nav-btn" onclick="switchTool('img2pdf')"><i class="fas fa-images"></i> Images to PDF</button>
            <button class="nav-btn" onclick="switchTool('excel2pdf')"><i class="fas fa-file-excel"></i> Excel to PDF</button>
            <button class="nav-btn" onclick="switchTool('text2pdf')"><i class="fas fa-file-alt"></i> Text to PDF</button>

            <div class="category-label">Convert From PDF</div>
            <button class="nav-btn" onclick="switchTool('pdf2word')"><i class="fas fa-file-word"></i> PDF to Word</button>
            <button class="nav-btn" onclick="switchTool('pdf2ppt')"><i class="fas fa-file-powerpoint"></i> PDF to PPT</button>
            <button class="nav-btn" onclick="switchTool('pdf2excel')"><i class="fas fa-table"></i> PDF to Excel</button>
            <button class="nav-btn" onclick="switchTool('pdf2img')"><i class="fas fa-image"></i> PDF to JPG</button>
        </div>

        <div class="main-content">
            
            <div id="merge" class="tool-panel active">
                <div class="card">
                    <h2>Merge PDFs</h2>
                    <p class="desc">Combine multiple files into one.</p>
                    <div class="drop-zone" onclick="document.getElementById('in-merge').click()">
                        <i class="fas fa-cloud-upload-alt drop-icon"></i>
                        <p>Click to select PDFs</p>
                        <input type="file" id="in-merge" hidden multiple accept=".pdf" onchange="addFiles('merge', this.files)">
                    </div>
                    <div id="list-merge" class="file-list"></div>
                    <button id="btn-merge" class="btn" disabled onclick="procMerge()">Merge Files</button>
                </div>
            </div>

            <div id="split" class="tool-panel">
                <div class="card">
                    <h2>Split PDF</h2>
                    <p class="desc">Extract specific pages.</p>
                    <div class="drop-zone" onclick="document.getElementById('in-split').click()">
                        <i class="fas fa-cut drop-icon"></i>
                        <p>Select PDF</p>
                        <input type="file" id="in-split" hidden accept=".pdf" onchange="setFile('split', this.files)">
                    </div>
                    <div id="list-split" class="file-list"></div>
                    <input type="text" id="opt-split-range" placeholder="Pages (e.g., 1-3, 5)">
                    <button id="btn-split" class="btn" disabled onclick="procSplit()">Split PDF</button>
                </div>
            </div>

            <div id="img2pdf" class="tool-panel">
                <div class="card">
                    <h2>Images to PDF</h2>
                    <div class="drop-zone" onclick="document.getElementById('in-img').click()">
                        <i class="fas fa-images drop-icon"></i>
                        <p>Select JPG/PNG</p>
                        <input type="file" id="in-img" hidden multiple accept="image/*" onchange="addFiles('img', this.files)">
                    </div>
                    <div id="list-img" class="file-list"></div>
                    <button id="btn-img" class="btn" disabled onclick="procImg2Pdf()">Convert to PDF</button>
                </div>
            </div>

            <div id="excel2pdf" class="tool-panel">
                <div class="card">
                    <h2>Excel to PDF</h2>
                    <div class="drop-zone" onclick="document.getElementById('in-excel').click()">
                        <i class="fas fa-file-excel drop-icon"></i>
                        <p>Select .xlsx file</p>
                        <input type="file" id="in-excel" hidden accept=".xlsx, .xls" onchange="setFile('excel', this.files)">
                    </div>
                    <div id="list-excel" class="file-list"></div>
                    <button id="btn-excel" class="btn" disabled onclick="procExcel2Pdf()">Convert to PDF</button>
                </div>
            </div>

            <div id="text2pdf" class="tool-panel">
                <div class="card">
                    <h2>Text to PDF</h2>
                    <p class="desc">Create a PDF from simple text.</p>
                    <textarea id="txt-content" placeholder="Type or paste your text here..."></textarea>
                    <button class="btn" onclick="procText2Pdf()">Save as PDF</button>
                </div>
            </div>

            <div id="pdf2word" class="tool-panel">
                <div class="card">
                    <h2>PDF to Word</h2>
                    <p class="desc">Extracts text and saves as Editable Word Doc (.doc).</p>
                    <div class="drop-zone" onclick="document.getElementById('in-p2w').click()">
                        <i class="fas fa-file-word drop-icon"></i>
                        <p>Select PDF</p>
                        <input type="file" id="in-p2w" hidden accept=".pdf" onchange="setFile('p2w', this.files)">
                    </div>
                    <div id="list-p2w" class="file-list"></div>
                    <button id="btn-p2w" class="btn" disabled onclick="procPdf2Word()">Convert to Word</button>
                </div>
            </div>

            <div id="pdf2ppt" class="tool-panel">
                <div class="card">
                    <h2>PDF to PowerPoint</h2>
                    <p class="desc">Converts PDF pages into PPT Slides.</p>
                    <div class="drop-zone" onclick="document.getElementById('in-p2ppt').click()">
                        <i class="fas fa-file-powerpoint drop-icon"></i>
                        <p>Select PDF</p>
                        <input type="file" id="in-p2ppt" hidden accept=".pdf" onchange="setFile('p2ppt', this.files)">
                    </div>
                    <div id="list-p2ppt" class="file-list"></div>
                    <button id="btn-p2ppt" class="btn" disabled onclick="procPdf2Ppt()">Convert to PPT</button>
                </div>
            </div>

            <div id="pdf2excel" class="tool-panel">
                <div class="card">
                    <h2>PDF to Excel</h2>
                    <p class="desc">Scrapes text from PDF to Excel. (Best for simple text data).</p>
                    <div class="drop-zone" onclick="document.getElementById('in-p2xl').click()">
                        <i class="fas fa-table drop-icon"></i>
                        <p>Select PDF</p>
                        <input type="file" id="in-p2xl" hidden accept=".pdf" onchange="setFile('p2xl', this.files)">
                    </div>
                    <div id="list-p2xl" class="file-list"></div>
                    <button id="btn-p2xl" class="btn" disabled onclick="procPdf2Excel()">Convert to Excel</button>
                </div>
            </div>

            <div id="pdf2img" class="tool-panel">
                <div class="card">
                    <h2>PDF to JPG</h2>
                    <p class="desc">Downloads pages as a ZIP of images.</p>
                    <div class="drop-zone" onclick="document.getElementById('in-p2i').click()">
                        <i class="fas fa-image drop-icon"></i>
                        <p>Select PDF</p>
                        <input type="file" id="in-p2i" hidden accept=".pdf" onchange="setFile('p2i', this.files)">
                    </div>
                    <div id="list-p2i" class="file-list"></div>
                    <button id="btn-p2i" class="btn" disabled onclick="procPdf2Img()">Convert to JPGs</button>
                </div>
            </div>

            <div id="watermark" class="tool-panel">
                <div class="card">
                    <h2>Watermark</h2>
                    <div class="drop-zone" onclick="document.getElementById('in-water').click()">
                        <i class="fas fa-stamp drop-icon"></i>
                        <p>Select PDF</p>
                        <input type="file" id="in-water" hidden accept=".pdf" onchange="setFile('water', this.files)">
                    </div>
                    <div id="list-water" class="file-list"></div>
                    <input type="text" id="txt-water" placeholder="Watermark Text (e.g. DRAFT)">
                    <button id="btn-water" class="btn" disabled onclick="procWatermark()">Apply Watermark</button>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- GLOBAL SETUP ---
        const { PDFDocument, rgb, degrees } = PDFLib;
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

        // State Store
        const state = {
            merge: [], img: [], split: null, excel: null, 
            p2w: null, p2ppt: null, p2xl: null, p2i: null, water: null
        };

        function switchTool(id) {
            document.querySelectorAll('.tool-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            // Find button with onclick containing the id
            const navs = document.querySelectorAll('.nav-btn');
            navs.forEach(n => {
                if(n.getAttribute('onclick').includes(id)) n.classList.add('active');
            });
        }

        // --- HELPER FUNCTIONS ---
        function addFiles(type, files) {
            state[type] = [...state[type], ...Array.from(files)];
            renderList(type);
        }
        function setFile(type, files) {
            state[type] = files[0];
            renderList(type, true);
        }
        function renderList(type, single = false) {
            const list = document.getElementById(`list-${type}`);
            const btn = document.getElementById(`btn-${type}`);
            if(single) {
                list.innerHTML = `<div class="file-item"><i class="fas fa-file"></i> ${state[type].name}</div>`;
                btn.disabled = false;
            } else {
                list.innerHTML = state[type].map(f => `<div class="file-item"><i class="fas fa-file"></i> ${f.name}</div>`).join('');
                btn.disabled = state[type].length === 0;
            }
        }
        async function getPdfDoc(file) {
            return await PDFDocument.load(await file.arrayBuffer());
        }
        async function getPdfJsDoc(file) {
            return await pdfjsLib.getDocument(await file.arrayBuffer()).promise;
        }

        // --- 1. MERGE ---
        async function procMerge() {
            const btn = document.getElementById('btn-merge');
            btn.innerHTML = 'Merging...';
            try {
                const merged = await PDFDocument.create();
                for (const file of state.merge) {
                    const pdf = await getPdfDoc(file);
                    const pages = await merged.copyPages(pdf, pdf.getPageIndices());
                    pages.forEach(p => merged.addPage(p));
                }
                download(await merged.save(), "merged.pdf", "application/pdf");
            } catch(e) { alert("Error: " + e.message); }
            btn.innerHTML = 'Merge Files';
        }

        // --- 2. SPLIT ---
        async function procSplit() {
            const btn = document.getElementById('btn-split');
            const range = document.getElementById('opt-split-range').value;
            btn.innerHTML = 'Splitting...';
            try {
                const pdf = await getPdfDoc(state.split);
                const newPdf = await PDFDocument.create();
                const total = pdf.getPageCount();
                
                // Parse Range (Basic)
                let indices = [];
                if(!range) { alert("Enter page range"); return; }
                range.split(',').forEach(p => {
                    if(p.includes('-')) {
                        const [s, e] = p.split('-').map(Number);
                        for(let i=s; i<=e; i++) indices.push(i-1);
                    } else indices.push(Number(p)-1);
                });

                const pages = await newPdf.copyPages(pdf, indices.filter(i => i >= 0 && i < total));
                pages.forEach(p => newPdf.addPage(p));
                download(await newPdf.save(), "split.pdf", "application/pdf");
            } catch(e) { alert("Error: " + e.message); }
            btn.innerHTML = 'Split PDF';
        }

        // --- 3. IMG 2 PDF ---
        async function procImg2Pdf() {
            const btn = document.getElementById('btn-img');
            btn.innerHTML = 'Converting...';
            try {
                const doc = await PDFDocument.create();
                for(const f of state.img) {
                    const img = f.type.includes('png') ? await doc.embedPng(await f.arrayBuffer()) : await doc.embedJpg(await f.arrayBuffer());
                    const page = doc.addPage([img.width, img.height]);
                    page.drawImage(img, { x:0, y:0, width: img.width, height: img.height });
                }
                download(await doc.save(), "images.pdf", "application/pdf");
            } catch(e) { alert("Error: " + e.message); }
            btn.innerHTML = 'Convert to PDF';
        }

        // --- 4. EXCEL 2 PDF ---
        function procExcel2Pdf() {
            const btn = document.getElementById('btn-excel');
            btn.innerHTML = 'Converting...';
            const reader = new FileReader();
            reader.onload = function(e) {
                const wb = XLSX.read(e.target.result, {type:'array'});
                const ws = wb.Sheets[wb.SheetNames[0]];
                const data = XLSX.utils.sheet_to_json(ws, {header:1});
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.autoTable({ head: [data[0]], body: data.slice(1) });
                doc.save("excel_data.pdf");
                btn.innerHTML = 'Convert to PDF';
            };
            reader.readAsArrayBuffer(state.excel);
        }

        // --- 5. TEXT 2 PDF ---
        function procText2Pdf() {
            const txt = document.getElementById('txt-content').value;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const splitTxt = doc.splitTextToSize(txt, 180);
            doc.text(splitTxt, 10, 10);
            doc.save("text_note.pdf");
        }

        // --- 6. PDF 2 WORD (Text Extraction) ---
        async function procPdf2Word() {
            const btn = document.getElementById('btn-p2w');
            btn.innerHTML = 'Extracting Text...';
            try {
                const pdf = await getPdfJsDoc(state.p2w);
                let fullText = "";
                for(let i=1; i<=pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const txt = await page.getTextContent();
                    fullText += txt.items.map(s => s.str).join(" ") + "\n\n";
                }
                // Create minimal .doc Blob
                const blob = new Blob(['<html><body><pre>' + fullText + '</pre></body></html>'], {
                    type: 'application/msword'
                });
                download(blob, "converted.doc", "application/msword");
            } catch(e) { alert("Error: " + e.message); }
            btn.innerHTML = 'Convert to Word';
        }

        // --- 7. PDF 2 PPT (Images to Slides) ---
        async function procPdf2Ppt() {
            const btn = document.getElementById('btn-p2ppt');
            btn.innerHTML = 'Rendering Slides...';
            try {
                const pdf = await getPdfJsDoc(state.p2ppt);
                let pptx = new PptxGenJS();
                
                for(let i=1; i<=pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 1.0 });
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    
                    await page.render({ canvasContext: ctx, viewport: viewport }).promise;
                    const imgData = canvas.toDataURL('image/png');
                    
                    let slide = pptx.addSlide();
                    slide.addImage({ data: imgData, x:0, y:0, w:'100%', h:'100%' });
                }
                pptx.writeFile({ fileName: "converted_presentation.pptx" });
            } catch(e) { console.log(e); alert("Error processing PPT"); }
            btn.innerHTML = 'Convert to PPT';
        }

        // --- 8. PDF 2 EXCEL (Text Dump) ---
        async function procPdf2Excel() {
            const btn = document.getElementById('btn-p2xl');
            btn.innerHTML = 'Scraping Data...';
            try {
                const pdf = await getPdfJsDoc(state.p2xl);
                let rows = [];
                for(let i=1; i<=pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const txt = await page.getTextContent();
                    // Simple logic: treat every string as a cell, try to group by Y position
                    let lineMap = {};
                    txt.items.forEach(item => {
                        const y = Math.round(item.transform[5]); // Group by Y coordinate
                        if(!lineMap[y]) lineMap[y] = [];
                        lineMap[y].push(item.str);
                    });
                    // Sort by Y (descending for PDF)
                    Object.keys(lineMap).sort((a,b) => b-a).forEach(y => {
                        rows.push(lineMap[y]); // Add row
                    });
                }
                
                const ws = XLSX.utils.aoa_to_sheet(rows);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "PDF Data");
                XLSX.writeFile(wb, "pdf_data.xlsx");
            } catch(e) { alert("Error: " + e.message); }
            btn.innerHTML = 'Convert to Excel';
        }

        // --- 9. PDF 2 JPG (ZIP) ---
        async function procPdf2Img() {
            const btn = document.getElementById('btn-p2i');
            btn.innerHTML = 'Processing...';
            try {
                const pdf = await getPdfJsDoc(state.p2i);
                const zip = new JSZip();
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 1.5 });
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    await page.render({ canvasContext: context, viewport: viewport }).promise;
                    zip.file(`page_${i}.jpg`, canvas.toDataURL('image/jpeg').split(',')[1], {base64: true});
                }
                download(await zip.generateAsync({type:"blob"}), "images.zip", "application/zip");
            } catch(e) { alert("Error"); }
            btn.innerHTML = 'Convert to JPGs';
        }

        // --- 10. WATERMARK ---
        async function procWatermark() {
            const btn = document.getElementById('btn-water');
            const text = document.getElementById('txt-water').value;
            if(!text) return;
            btn.innerHTML = 'Applying...';
            try {
                const pdf = await getPdfDoc(state.water);
                const pages = pdf.getPages();
                pages.forEach(p => {
                    const { width, height } = p.getSize();
                    p.drawText(text, {
                        x: 50, y: height/2, size: 50,
                        color: rgb(0.5, 0.5, 0.5), opacity: 0.5, rotate: degrees(45)
                    });
                });
                download(await pdf.save(), "watermarked.pdf", "application/pdf");
            } catch(e) { alert("Error"); }
            btn.innerHTML = 'Apply Watermark';
        }

    </script>
</body>
</html>
